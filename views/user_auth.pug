doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(http-equiv="X-UA-Compatible" content="IE=edge")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    link(rel="stylesheet" href="../style.css")
    title Your Past Appointments
    style.
      body {
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(120deg, #434343, #000000);
        color: white;
      }
      .login-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 5px;
      }
      .login-container {
        position: relative;
        padding: 40px 30px 30px;
        border-radius: 15px;
        background: #2c3e50;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        min-width: 340px;
        max-width: 380px;
        width: 90%;
        text-align: center;
      }
      .close-btn {
        position: absolute;
        top: 15px;
        right: 18px;
        cursor: pointer;
        font-size: 24px;
        color: #ecf0f1;
        transition: color 0.3s;
      }
      .close-btn:hover { color: #e74c3c; }
      .login-container h2 {
        margin-bottom: 25px;
        font-weight: 600;
        color: #ecf0f1;
      }
      .login-container input {
        display: block;
        margin-bottom: 15px;
        padding: 12px;
        width: 100%;
        border: none;
        border-radius: 6px;
        background: #34495e;
        color: white;
      }
      .login-container button {
        padding: 12px;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        width: 100%;
        font-weight: bold;
        transition: background 0.3s;
      }
      .btn-view { background: #3498db; }
      .btn-view:hover { background: #2980b9; }
      .btn-otp { background: #f39c12; }
      .btn-otp:hover { background: #d68910; }
      .error-message { color: #e74c3c; margin-top: 15px; font-weight: bold; font-size: 14px; }

  body
    .login-wrapper
      .login-container
        //- Close button
        span.close-btn(aria-label="Close") &times;

        //- Title
        h2 Your Past Appointments

        //- User login form
        form(action="/user/auth", method="POST")
          input(type="email", id="email", name="email", placeholder="Enter Registered Email", required)
          button(type="button", class="btn-otp", onclick="sendEmailOtp()") Send OTP to Email
          input(type="number", id="emailOtp", name="emailOtp", placeholder="Enter Email OTP", pattern="\\d{6}", required)
          button(type="submit", class="btn-view") View

        //- Error message
        if error
          .error-message
            p #{error}

    script.
      async function sendEmailOtp() {
        const emailInput = document.getElementById('email');
        const email = emailInput.value.trim();
        if (!email) return alert('Enter an email first');
        emailInput.readOnly = true;

        try {
          const res = await fetch('/send-usr-email-otp', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email: email,
              subject: 'OTP to fetch your past Appointments on Tickr',
              message: 'OTP to fetch your past Appointments on Tickr'
            })
          });
          const data = await res.json();
          alert(data.message || data.error || 'OTP sent to email');
        } catch (err) {
          console.error(err);
          alert('Failed to send OTP. Please try again.');
          emailInput.readOnly = false;
        }
      }

    script.
      document.addEventListener('DOMContentLoaded', function () {
        const closeBtn = document.querySelector('.close-btn');
        closeBtn.addEventListener('click', () => window.history.go(-1));
      });
